#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "generate.h"
#include "format.h"
#include "masking.h"


// /////////////////////////////////////////////////////////////////////////////
//    Macro declarations
// /////////////////////////////////////////////////////////////////////////////


// /////////////////////////////////////////////////////////////////////////////
//    Type declarations
// /////////////////////////////////////////////////////////////////////////////


// /////////////////////////////////////////////////////////////////////////////
//    Variables declarations
// /////////////////////////////////////////////////////////////////////////////

int g_fStr[4][8][15] = {
    /* Format information strings: */
    {
        /* L */
        { 1,1,1,0,1,1,1,1,1,0,0,0,1,0,0 },
        { 1,1,1,0,0,1,0,1,1,1,1,0,0,1,1 },
        { 1,1,1,1,1,0,1,1,0,1,0,1,0,1,0 },
        { 1,1,1,1,0,0,0,1,0,0,1,1,1,0,1 },
        { 1,1,0,0,1,1,0,0,0,1,0,1,1,1,1 },
        { 1,1,0,0,0,1,1,0,0,0,1,1,0,0,0 },
        { 1,1,0,1,1,0,0,0,1,0,0,0,0,0,1 },
        { 1,1,0,1,0,0,1,0,1,1,1,0,1,1,0 }
    },
    {
        /* M */
        { 1,0,1,0,1,0,0,0,0,0,1,0,0,1,0 },
        { 1,0,1,0,0,0,1,0,0,1,0,0,1,0,1 },
        { 1,0,1,1,1,1,0,0,1,1,1,1,1,0,0 },
        { 1,0,1,1,0,1,1,0,1,0,0,1,0,1,1 },
        { 1,0,0,0,1,0,1,1,1,1,1,1,0,0,1 },
        { 1,0,0,0,0,0,0,1,1,0,0,1,1,1,0 },
        { 1,0,0,1,1,1,1,1,0,0,1,0,1,1,1 },
        { 1,0,0,1,0,1,0,1,0,1,0,0,0,0,0 }
    },
    {
        /* Q */
        { 0,1,1,0,1,0,1,0,1,0,1,1,1,1,1 },
        { 0,1,1,0,0,0,0,0,1,1,0,1,0,0,0 },
        { 0,1,1,1,1,1,1,0,0,1,1,0,0,0,1 },
        { 0,1,1,1,0,1,0,0,0,0,0,0,1,1,0 },
        { 0,1,0,0,1,0,0,1,0,1,1,0,1,0,0 },
        { 0,1,0,0,0,0,1,1,0,0,0,0,0,1,1 },
        { 0,1,0,1,1,1,0,1,1,0,1,1,0,1,0 },
        { 0,1,0,1,0,1,1,1,1,1,0,1,1,0,1 }
    },
    {
        /* H */
        { 0,0,1,0,1,1,0,1,0,0,0,1,0,0,1 },
        { 0,0,1,0,0,1,1,1,0,1,1,1,1,1,0 },
        { 0,0,1,1,1,0,0,1,1,1,0,0,1,1,1 },
        { 0,0,1,1,0,0,1,1,1,0,1,0,0,0,0 },
        { 0,0,0,0,1,1,1,0,1,1,0,0,0,1,0 },
        { 0,0,0,0,0,1,0,0,1,0,1,0,1,0,1 },
        { 0,0,0,1,1,0,1,0,0,0,0,1,1,0,0 },
        { 0,0,0,1,0,0,0,0,0,1,1,1,0,1,1 }
    }
};

int g_vStr[34][18] = {
    /* Version Information String */
    { 0,0,0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,0 }, //7
    { 0,0,1,0,0,0,0,1,0,1,1,0,1,1,1,1,0,0 }, //8
    { 0,0,1,0,0,1,1,0,1,0,1,0,0,1,1,0,0,1 }, //9
    { 0,0,1,0,1,0,0,1,0,0,1,1,0,1,0,0,1,1 }, //10
    { 0,0,1,0,1,1,1,0,1,1,1,1,1,1,0,1,1,0 }, //11
    { 0,0,1,1,0,0,0,1,1,1,0,1,1,0,0,0,1,0 }, //12
    { 0,0,1,1,0,1,1,0,0,0,0,1,0,0,0,1,1,1 }, //13
    { 0,0,1,1,1,0,0,1,1,0,0,0,0,0,1,1,0,1 }, //14
    { 0,0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,0,0 }, //15
    { 0,1,0,0,0,0,1,0,1,1,0,1,1,1,1,0,0,0 }, //16
    { 0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,0,1 }, //17
    { 0,1,0,0,1,0,1,0,1,0,0,0,0,1,0,1,1,1 }, //18
    { 0,1,0,0,1,1,0,1,0,1,0,0,1,1,0,0,1,0 }, //19
    { 0,1,0,1,0,0,1,0,0,1,1,0,1,0,0,1,1,0 }, //20
    { 0,1,0,1,0,1,0,1,1,0,1,0,0,0,0,0,1,1 }, //21
    { 0,1,0,1,1,0,1,0,0,0,1,1,0,0,1,0,0,1 }, //22
    { 0,1,0,1,1,1,0,1,1,1,1,1,1,0,1,1,0,0 }, //23
    { 0,1,1,0,0,0,1,1,1,0,1,1,0,0,0,1,0,0 }, //24
    { 0,1,1,0,0,1,0,0,0,1,1,1,1,0,0,0,0,1 }, //25
    { 0,1,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,1 }, //26
    { 0,1,1,0,1,1,0,0,0,0,1,0,0,0,1,1,1,0 }, //27
    { 0,1,1,1,0,0,1,1,0,0,0,0,0,1,1,0,1,0 }, //28
    { 0,1,1,1,0,1,0,0,1,1,0,0,1,1,1,1,1,1 }, //29
    { 0,1,1,1,1,0,1,1,0,1,0,1,1,1,0,1,0,1 }, //30
    { 0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,0,0,0 }, //31
    { 1,0,0,0,0,0,1,0,0,1,1,1,0,1,0,1,0,1 }, //32
    { 1,0,0,0,0,1,0,1,1,0,1,1,1,1,0,0,0,0 }, //33
    { 1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,0,1,0 }, //34
    { 1,0,0,0,1,1,0,1,1,1,1,0,0,1,1,1,1,1 }, //35
    { 1,0,0,1,0,0,1,0,1,1,0,0,0,0,1,0,1,1 }, //36
    { 1,0,0,1,0,1,0,1,0,0,0,0,1,0,1,1,1,0 }, //37
    { 1,0,0,1,1,0,1,0,1,0,0,1,1,0,0,1,0,0 }, //38
    { 1,0,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,1 }, //39
    { 1,0,1,0,0,0,1,1,0,0,0,1,1,0,1,0,0,1 }  //40
};


// /////////////////////////////////////////////////////////////////////////////
//    Functions
// /////////////////////////////////////////////////////////////////////////////

void qr_format_version(void)
{
    int (*matrix)[MAX_SIZE] = g_masking[g_maskId];
    int offset = (4 * g_version) + 9;
    int level = g_level - 1;
    int version = g_version - 7;
    int x, y;
    int i;


    /* Format string */
    i = 0;
    for (x=0, y=8; x<8; x++)
    {
        /* top left: horizontal */
        if (x != 6) matrix[x][y] = g_fStr[level][g_maskId][i++];
    }
    for (x=8, y=8; y>=0; y--)
    {
        /* top left: vertical */
        if (y != 6) matrix[x][y] = g_fStr[level][g_maskId][i++];
    }
    i = 0;
    for (x=8, y=(offset+7); y>=(offset+1); y--)
    {
        /* bottom left: vertical */
        matrix[x][y] = g_fStr[level][g_maskId][i++];
    }
    for (x=offset, y=8; x<(offset+8); x++)
    {
        /* top right: horizontal */
        matrix[x][y] = g_fStr[level][g_maskId][i++];
    }

    /* Version string */
    if (g_version >= 7)
    {
        i = 0;
        /* bottom left: 6x3 */
        for (x=0; x<6; x++)
        {
            for (y=(offset-3); y<(offset); y++)
            {
                matrix[x][y] = g_vStr[version][i++];
            }
        }
        i = 0;
        /* top right: 3x6 */
        for (x=(offset-3); x<(offset); x++)
        {
            for (y=0; y<6; y++)
            {
                matrix[x][y] = g_vStr[version][i++];
            }
        }
    }
}

